import{b as y,c as u,e as x,f as I,i as F,k as D,l as T,p as E,r as N,t as R,u as L,v as k,w as j,x as q}from"./chunk-HO2SQRUA.js";import{a as f}from"./chunk-N35DKANW.js";import{a as A}from"./chunk-TKIRZA44.js";import{f as S}from"./chunk-ZUXIL7TL.js";import{$b as w,Da as l,Ia as m,Oa as p,Sa as g,Xb as O,Za as c,cb as n,db as o,eb as C,jb as b,kb as M,la as _,tb as s,vb as v,w as P}from"./chunk-EUQM6YRV.js";var h=class a{constructor(i,r,t){this.authService=i;this.dialogRef=r;this.data=t;this.startTimer()}verified=new _;showToast=new _;otpCode="";countdown=300;canResend=!1;timerSub;baseUrl=A.baseUrl;config={length:4,inputClass:"otp-input",allowNumbersOnly:!0,isPasswordInput:!1,autofocus:!0,placeholder:""};startTimer(){this.countdown=300,this.canResend=!1,this.timerSub?.unsubscribe(),this.timerSub=P(1e3).subscribe(()=>{this.countdown--,this.countdown<=0&&(this.canResend=!0,this.timerSub.unsubscribe())})}onOtpChange(i){this.otpCode=i}handleSubmit(){if(this.otpCode.length!==4){this.showToast.emit("Please enter the 4-digit OTP");return}this.authService.verifyLoginOtp({phone:this.data.phone,otp:this.otpCode}).subscribe({next:()=>{this.verified.emit(),this.dialogRef.close(!0)},error:()=>{this.showToast.emit("Invalid or expired OTP")}})}ngOnDestroy(){this.timerSub?.unsubscribe()}get phone(){return this.data.phone}get type(){return this.data.type}static \u0275fac=function(r){return new(r||a)(m(f),m(L),m(k))};static \u0275cmp=p({type:a,selectors:[["app-four-digit-otp-modal"]],outputs:{verified:"verified",showToast:"showToast"},decls:2,vars:0,template:function(r,t){r&1&&(n(0,"p"),s(1,"four-digit-otp-modal works!"),o())},encapsulation:2})};function H(a,i){a&1&&(n(0,"small"),s(1,"Phone number is required."),o())}function Y(a,i){a&1&&(n(0,"small"),s(1,"Invalid phone number format."),o())}function $(a,i){if(a&1&&(n(0,"div",15),g(1,H,2,0,"small",16)(2,Y,2,0,"small",16),o()),a&2){let r,t,e=M();l(),c("ngIf",(r=e.loginForm.get("phone"))==null||r.errors==null?null:r.errors.required),l(),c("ngIf",(t=e.loginForm.get("phone"))==null||t.errors==null?null:t.errors.pattern)}}function J(a,i){a&1&&(n(0,"div",15)(1,"small"),s(2,"Password is required."),o()())}var z=class a{constructor(i,r,t,e,d){this.fb=i;this.authService=r;this.toast=t;this.router=e;this.dialog=d;this.loginForm=this.fb.group({phone:["",[u.required,u.pattern(/^[0-9]{10,15}$/)]],password:["",[u.required]]})}loginForm;loginPending=!1;showPassword=!1;togglePasswordVisibility(){this.showPassword=!this.showPassword}handleSubmit(){if(this.loginForm.invalid)return;this.loginPending=!0;let{phone:i,password:r}=this.loginForm.value;this.authService.login({phone:i,password:r}).subscribe({next:()=>{let t=this.dialog.open(h,{data:{phone:i,type:"login"},disableClose:!0});t.componentInstance.verified.subscribe(()=>{let e=this.authService.getUser();this.toast.success("Login successful"),e?.isArtisan?this.router.navigate(["/artisan-dashboard"]):this.router.navigate(["/user-dashboard"])}),t.componentInstance.showToast.subscribe(e=>{this.toast.error(e)})},error:t=>{let e=t.error?.message;e==="User is not verified"?this.toast.warning("Account not verified. Please register again or contact support."):this.toast.error(e||"Invalid phone number or password")},complete:()=>{this.loginPending=!1}})}onToast(i){this.toast.show(i)}static \u0275fac=function(r){return new(r||a)(m(N),m(f),m(q),m(S),m(j))};static \u0275cmp=p({type:a,selectors:[["app-login"]],decls:27,vars:7,consts:[[1,"login-container"],[1,"login-card"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","phone"],["id","phone","type","tel","formControlName","phone","placeholder","233241234567","required",""],["class","error",4,"ngIf"],["for","password"],[1,"password-wrapper"],["id","password","formControlName","password","placeholder","Enter your password","required","",3,"type"],["type","button",1,"toggle-password",3,"click"],["type","submit",3,"disabled"],[1,"footer-text"],["routerLink","/register"],[1,"error"],[4,"ngIf"]],template:function(r,t){if(r&1&&(n(0,"div",0)(1,"div",1)(2,"h2"),s(3,"Sign in"),o(),n(4,"p",2),s(5,"Enter your credentials to access your account"),o(),n(6,"form",3),b("ngSubmit",function(){return t.handleSubmit()}),n(7,"div",4)(8,"label",5),s(9,"Phone Number"),o(),C(10,"input",6),g(11,$,3,2,"div",7),o(),n(12,"div",4)(13,"label",8),s(14,"Password"),o(),n(15,"div",9),C(16,"input",10),n(17,"button",11),b("click",function(){return t.showPassword=!t.showPassword}),s(18),o()(),g(19,J,3,0,"div",7),o(),n(20,"button",12),s(21),o()(),n(22,"div",13)(23,"span"),s(24,"Don't have an account? "),o(),n(25,"a",14),s(26,"Sign up"),o()()()()),r&2){let e,d;l(6),c("formGroup",t.loginForm),l(5),c("ngIf",((e=t.loginForm.get("phone"))==null?null:e.touched)&&((e=t.loginForm.get("phone"))==null?null:e.invalid)),l(5),c("type",t.showPassword?"text":"password"),l(2),v(" ",t.showPassword?"Hide":"Show"," "),l(),c("ngIf",((d=t.loginForm.get("password"))==null?null:d.touched)&&((d=t.loginForm.get("password"))==null?null:d.invalid)),l(),c("disabled",t.loginPending||t.loginForm.invalid),l(),v(" ",t.loginPending?"Signing in...":"Sign in"," ")}},dependencies:[w,O,R,F,y,x,I,E,D,T],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem 1rem;background-color:#f9fafb;min-height:100vh}.login-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background-color:#fff;padding:2rem;border-radius:.5rem;box-shadow:0 2px 8px #0000001a}.login-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:1.75rem;font-weight:600;margin-bottom:.5rem}.login-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{text-align:center;font-size:.95rem;color:#6b7280;margin-bottom:1.5rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:#374151;margin-bottom:.25rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.95rem;outline:none;transition:border-color .2s}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]{position:relative}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding-right:4rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]   .toggle-password[_ngcontent-%COMP%]{position:absolute;top:50%;right:.75rem;transform:translateY(-50%);background:none;border:none;color:#2563eb;font-size:.85rem;cursor:pointer}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{margin-top:.25rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#dc2626;font-size:.8rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:.5rem;border:none;border-radius:.375rem;font-weight:600;cursor:pointer;transition:background-color .2s}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;font-size:.875rem;color:#6b7280}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-weight:500}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline;color:#1d4ed8}"]})};export{z as LoginComponent};
