import{a as x,b,c as I,d as F,e as D,f as T,g as E,k,l as N,m as R,n as A,o as L,p as j,q,r as z,s as G,t as V,u as U}from"./chunk-VQFYNAVO.js";import{a as v}from"./chunk-5QEJCEUV.js";import"./chunk-MXJ22REZ.js";import{a as B,b as H}from"./chunk-PMSINFUO.js";import{Aa as h,Ia as o,Ja as O,Ka as w,Q as P,_ as s,bb as _,ca as d,fa as f,fb as C,ja as g,mb as y,na as m,o as S,sa as e,ta as n,ua as u,za as c}from"./chunk-O67RTWPF.js";function X(a,l){if(a&1&&(e(0,"span"),o(1," Resend OTP in "),e(2,"strong"),o(3),n(),o(4,"s "),n()),a&2){let r=h();s(3),O(r.countdown)}}var M=class a{constructor(l,r,t){this.authService=l;this.dialogRef=r;this.data=t;this.startTimer()}verified=new P;showToast=new P;otpCode="";countdown=300;canResend=!1;timerSub;config={length:4,inputClass:"otp-input",allowNumbersOnly:!0,isPasswordInput:!1,autofocus:!0,placeholder:""};startTimer(){this.countdown=300,this.canResend=!1,this.timerSub?.unsubscribe(),this.timerSub=S(1e3).subscribe(()=>{this.countdown--,this.countdown<=0&&(this.canResend=!0,this.timerSub.unsubscribe())})}onOtpChange(l){this.otpCode=l}handleSubmit(){if(this.otpCode.length!==4){this.showToast.emit("Please enter the 4-digit OTP");return}this.authService.verifyLoginOtp({phone:this.data.phone,otp:this.otpCode}).subscribe({next:()=>{this.verified.emit(),this.dialogRef.close(!0)},error:()=>{this.showToast.emit("Invalid or expired OTP")}})}ngOnDestroy(){this.timerSub?.unsubscribe()}get phone(){return this.data.phone}get type(){return this.data.type}static \u0275fac=function(r){return new(r||a)(d(v),d(q),d(z))};static \u0275cmp=f({type:a,selectors:[["app-four-digit-otp-modal"]],outputs:{verified:"verified",showToast:"showToast"},decls:16,vars:4,consts:[[1,"otp-modal-backdrop"],[1,"otp-modal"],[1,"close-btn",3,"click"],[1,"title"],[1,"subtitle"],[1,"phone"],[3,"onInputChange","config"],[1,"resend-section"],[4,"ngIf"],["type","button",1,"verify-btn",3,"click","disabled"]],template:function(r,t){r&1&&(e(0,"div",0)(1,"div",1)(2,"button",2),c("click",function(){return t.dialogRef.close()}),o(3,"\xD7"),n(),e(4,"h2",3),o(5,"Enter OTP"),n(),e(6,"p",4),o(7," We've sent a 4-digit verification code to "),e(8,"span",5),o(9),n(),o(10,". "),n(),e(11,"ng-otp-input",6),c("onInputChange",function(p){return t.onOtpChange(p)}),n(),e(12,"div",7),g(13,X,5,1,"span",8),n(),e(14,"button",9),c("click",function(){return t.handleSubmit()}),o(15," Verify "),n()()()),r&2&&(s(9),O(t.phone),s(2),m("config",t.config),s(2),m("ngIf",!t.canResend),s(),m("disabled",t.otpCode.length<4))},dependencies:[C,_,R,j,L],encapsulation:2})};function Z(a,l){a&1&&(e(0,"small"),o(1,"Phone number is required."),n())}function tt(a,l){a&1&&(e(0,"small"),o(1,"Invalid phone number format."),n())}function et(a,l){if(a&1&&(e(0,"div",15),g(1,Z,2,0,"small",16)(2,tt,2,0,"small",16),n()),a&2){let r,t,i=h();s(),m("ngIf",(r=i.loginForm.get("phone"))==null||r.errors==null?null:r.errors.required),s(),m("ngIf",(t=i.loginForm.get("phone"))==null||t.errors==null?null:t.errors.pattern)}}function nt(a,l){a&1&&(e(0,"div",15)(1,"small"),o(2,"Password is required."),n()())}var W=class a{constructor(l,r,t,i,p){this.fb=l;this.authService=r;this.toast=t;this.router=i;this.dialog=p;this.loginForm=this.fb.group({phone:["",[b.required,b.pattern(/^[0-9]{10,15}$/)]],password:["",[b.required]]})}loginForm;loginPending=!1;showPassword=!1;togglePasswordVisibility(){this.showPassword=!this.showPassword}handleSubmit(){if(this.loginForm.invalid)return;this.loginPending=!0;let{phone:l,password:r}=this.loginForm.value;this.authService.login({phone:l,password:r}).subscribe({next:()=>{let t=this.dialog.open(M,{data:{phone:l,type:"login"},disableClose:!0,width:"700px"});t.componentInstance.verified.subscribe(()=>{let i=this.authService.getUser();this.toast.success("Login successful"),i?.isArtisan?this.router.navigate(["/artisan-dashboard"]):this.router.navigate(["/user-dashboard"])}),t.componentInstance.showToast.subscribe(i=>{this.toast.error(i)})},error:t=>{let i=t.error?.message;i==="User is not verified"?this.toast.warning("Account not verified. Please register again or contact support."):this.toast.error(i||"Invalid phone number or password")},complete:()=>{this.loginPending=!1}})}onToast(l){this.toast.show(l)}static \u0275fac=function(r){return new(r||a)(d(N),d(v),d(U),d(y),d(G))};static \u0275cmp=f({type:a,selectors:[["app-login"]],decls:29,vars:7,consts:[[1,"login-container"],[1,"login-card"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","phone"],["id","phone","type","tel","formControlName","phone","placeholder","233241234567","required",""],["class","error",4,"ngIf"],["for","password"],[1,"password-wrapper"],["id","password","formControlName","password","placeholder","Enter your password","required","",3,"type"],["type","button",1,"toggle-password",3,"click"],["type","submit",3,"disabled"],[1,"footer-text"],["routerLink","/become-artisan"],[1,"error"],[4,"ngIf"]],template:function(r,t){if(r&1&&(u(0,"app-header"),e(1,"div",0)(2,"div",1)(3,"h2"),o(4,"Sign in"),n(),e(5,"p",2),o(6,"Enter your credentials to access your account"),n(),e(7,"form",3),c("ngSubmit",function(){return t.handleSubmit()}),e(8,"div",4)(9,"label",5),o(10,"Phone Number"),n(),u(11,"input",6),g(12,et,3,2,"div",7),n(),e(13,"div",4)(14,"label",8),o(15,"Password"),n(),e(16,"div",9),u(17,"input",10),e(18,"button",11),c("click",function(){return t.showPassword=!t.showPassword}),o(19),n()(),g(20,nt,3,0,"div",7),n(),e(21,"button",12),o(22),n()(),e(23,"div",13)(24,"span"),o(25,"Don't have an account? "),n(),e(26,"a",14),o(27,"Sign up"),n()()()(),u(28,"app-footer")),r&2){let i,p;s(7),m("formGroup",t.loginForm),s(5),m("ngIf",((i=t.loginForm.get("phone"))==null?null:i.touched)&&((i=t.loginForm.get("phone"))==null?null:i.invalid)),s(5),m("type",t.showPassword?"text":"password"),s(2),w(" ",t.showPassword?"Hide":"Show"," "),s(),m("ngIf",((p=t.loginForm.get("password"))==null?null:p.touched)&&((p=t.loginForm.get("password"))==null?null:p.invalid)),s(),m("disabled",t.loginPending||t.loginForm.invalid),s(),w(" ",t.loginPending?"Signing in...":"Sign in"," ")}},dependencies:[C,_,A,D,x,I,F,k,T,E,V,H,B],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem 1rem;background-color:#f9fafb;min-height:100vh}.login-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background-color:#fff;padding:2rem;border-radius:.5rem;box-shadow:0 2px 8px #0000001a}.login-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:1.75rem;font-weight:600;margin-bottom:.5rem}.login-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{text-align:center;font-size:.95rem;color:#6b7280;margin-bottom:1.5rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:#374151;margin-bottom:.25rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.95rem;outline:none;transition:border-color .2s}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]{position:relative}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding-right:4rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]   .toggle-password[_ngcontent-%COMP%]{position:absolute;top:50%;right:.75rem;transform:translateY(-50%);background:none;border:none;color:#2563eb;font-size:.85rem;cursor:pointer}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{margin-top:.25rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#dc2626;font-size:.8rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:.5rem;border:none;border-radius:.375rem;font-weight:600;cursor:pointer;transition:background-color .2s}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;font-size:.875rem;color:#6b7280}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-weight:500}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline;color:#1d4ed8}"]})};export{W as LoginComponent};
