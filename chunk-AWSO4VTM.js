import{a as rt,b as N,c as _,d as st,e as T,f as at,g as lt,h as ct,i as pt,j as ut,k as mt,l as dt,m as gt,n as ft,o as ht,p as Ct,q as _t,r as bt,s as vt,t as E,u as yt,v as Ot,w as xt,x as wt}from"./chunk-HO2SQRUA.js";import{a as F}from"./chunk-N35DKANW.js";import{a as V}from"./chunk-TKIRZA44.js";import{f as nt,g as it,j as ot}from"./chunk-ZUXIL7TL.js";import{$b as P,A as L,Da as c,Ia as u,Mb as X,O as q,Oa as b,Pa as H,R as z,Sa as v,T as G,Vb as $,Wb as tt,Xb as I,Yb as et,Za as p,ab as R,ca as f,cb as a,da as h,db as s,eb as O,fb as Y,gb as J,h as M,hb as x,ia as U,jb as g,kb as m,l as K,la as D,nb as W,tb as l,ub as A,vb as S,w as j,wb as Z,xb as Q}from"./chunk-EUQM6YRV.js";var Nt=r=>({"error-input":r});function Tt(r,o){if(r&1&&(a(0,"span"),l(1),s()),r&2){let t=m(3);c(),S(" ",t.config.separator," ")}}function Et(r,o){if(r&1){let t=x();Y(0),a(1,"input",5,0),g("paste",function(n){f(t);let i=m(2);return h(i.handlePaste(n))})("keyup",function(n){let i=f(t).index,d=m(2);return h(d.onKeyUp(n,i))})("input",function(n){let i=f(t).index,d=m(2);return h(d.onInput(n,i))})("keydown",function(n){let i=f(t).index,d=m(2);return h(d.onKeyDown(n,i))}),s(),v(3,Tt,2,1,"span",6),J()}if(r&2){let t=o.$implicit,e=o.index,n=o.last,i=m(2);c(),R("otp-input ",i.config.inputClass,""),p("pattern",i.config.allowNumbersOnly?"\\d*":"")("type",i.inputType)("placeholder",(i.config==null?null:i.config.placeholder)||"")("ngStyle",i.config.inputStyles)("formControl",i.otpForm.controls[t])("id",i.getBoxId(e))("ngClass",Q(11,Nt,(i.config==null?null:i.config.showError)&&(i.formControl==null?null:i.formControl.invalid)&&((i.formControl==null?null:i.formControl.dirty)||(i.formControl==null?null:i.formControl.touched)))),c(2),p("ngIf",i.config.separator&&!n)}}function Vt(r,o){if(r&1){let t=x();a(0,"div",2),g("focusin",function(){f(t);let n=m();return h(n.onFocusIn())})("focusout",function(){f(t);let n=m();return h(n.onFocusOut())}),a(1,"div",3),v(2,Et,4,13,"ng-container",4),s()()}if(r&2){let t=m();R("ng-otp-input-wrapper wrapper ",t.config.containerClass,""),W("id","c_",t.componentKey,""),p("ngStyle",t.config.containerStyles),c(2),p("ngForOf",t.controlKeys)}}var C=class{static ifTab(o){return this.ifKey(o,"Tab")}static ifDelete(o){return this.ifKey(o,"Delete;Del")}static ifBackspace(o){return this.ifKey(o,"Backspace")}static ifRightArrow(o){return this.ifKey(o,"ArrowRight;Right")}static ifLeftArrow(o){return this.ifKey(o,"ArrowLeft;Left")}static ifSpacebar(o){return this.ifKey(o,"Spacebar; ")}static ifKey(o,t){return t.split(";").some(n=>n===o.key)}},w=class{static keys(o){return o?Object.keys(o):[]}},B=(()=>{class r{set disabled(t){this.setDisabledState(t)}get inputType(){return this.config?.isPasswordInput?"password":this.config?.allowNumbersOnly?"tel":"text"}get controlKeys(){return w.keys(this.otpForm?.controls)}get formControl(){return this.formCtrl??this.inj?.get(st)}constructor(t,e){this.document=t,this.inj=e,this.config={length:4},this.onBlur=new M,this.onInputChange=new M,this.inputControls=new Array(this.config.length),this.componentKey=Math.random().toString(36).substring(2)+new Date().getTime().toString(36),this.destroy$=new M,this.activeFocusCount=0,this.onChange=()=>{},this.onTouched=()=>{},this._isDisabled=!1}ngOnInit(){this.otpForm=new lt({});for(let t=0;t<this.config.length;t++)this.otpForm.addControl(this.getControlName(t),new ct);this.otpForm.valueChanges.pipe(q(this.destroy$)).subscribe(t=>{w.keys(this.otpForm.controls).forEach(e=>{var n=this.otpForm.controls[e].value;n&&n.length>1&&(n.length>=this.config.length?this.setValue(n):this.rebuildValue())})})}setDisabledState(t){this._isDisabled=t,this.otpForm&&(t?this.otpForm.disable({emitEvent:!1}):this.otpForm.enable({emitEvent:!1}))}writeValue(t){this.currentVal=this.hasVal(t)?t:null,this.setValue(this.currentVal)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}onFocusIn(){this.onTouched(),this.activeFocusCount++}onFocusOut(){setTimeout(()=>{this.activeFocusCount--,this.activeFocusCount===0&&(this.onTouched(),this.onBlur.next())},0)}ngAfterViewInit(){if(!this.config.disableAutoFocus){let t=this.document.getElementById(`c_${this.componentKey}`);if(t){let e=t.getElementsByClassName("otp-input")[0];e&&e.focus&&e.focus()}}}getControlName(t){return`ctrl_${t}`}onKeyDown(t,e){let n=this.getBoxId(e-1),i=this.getBoxId(e);if(C.ifKey(t,"Enter")){let y=this.document.getElementById(i)?.closest("form");if(y){t.preventDefault(),y.dispatchEvent(new Event("submit"));return}}if(C.ifSpacebar(t))return t.preventDefault(),!1;if(C.ifBackspace(t)){t.target.value?this.clearInput(i,e):(this.clearInput(n,e-1),this.setSelected(n)),this.rebuildValue();return}if(C.ifDelete(t)){t.target.value?this.clearInput(i,e):(this.clearInput(n,e-1),this.setSelected(n)),this.rebuildValue();return}}hasVal(t){return t!=null&&t!=null&&(!t?.trim||t.trim()!="")}onInput(t,e){let n=this.hasVal(this.currentVal)?`${this.currentVal}${t.target.value}`:t.target.value;if(this.config.allowNumbersOnly&&!this.validateNumber(n)){t.target.value=null,t.stopPropagation(),t.preventDefault(),this.clearInput(null,e);return}if(this.ifValidKeyCode(null,t.target.value)){let i=this.getBoxId(e+1);this.setSelected(i),this.rebuildValue()}else{t.target.value=null;let i=this.getControlName(e);this.otpForm.controls[i]?.setValue(null),this.rebuildValue()}}onKeyUp(t,e){C.ifTab(t)&&(e-=1);let n=this.getBoxId(e+1),i=this.getBoxId(e-1);if(C.ifRightArrow(t)){t.preventDefault(),this.setSelected(n);return}if(C.ifLeftArrow(t)){t.preventDefault(),this.setSelected(i);return}}validateNumber(t){return t&&/^[0-9]+$/.test(t)}getBoxId(t){return`otp_${t}_${this.componentKey}`}clearInput(t,e){let n=this.getControlName(e);if(this.otpForm.controls[n]?.setValue(null),t){let i=this.document.getElementById(t);i&&i instanceof HTMLInputElement&&(i.value=null)}}setSelected(t){this.focusTo(t);let e=this.document.getElementById(t);e&&e.setSelectionRange&&setTimeout(()=>{e.setSelectionRange(0,1)},0)}ifValidKeyCode(t,e){let n=e??t.key;return this.config?.allowNumbersOnly?this.validateNumber(n):/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||/^[a-zA-Z0-9%*_\-@#$!]$/.test(n)&&n.length==1}focusTo(t){let e=this.document.getElementById(t);e&&e.focus()}setValue(t){if(!(this.config.allowNumbersOnly&&isNaN(t))){if(this.otpForm?.reset(),!this.hasVal(t)){this.rebuildValue();return}t=t.toString().replace(/\s/g,""),Array.from(t).forEach((e,n)=>{this.otpForm.get(this.getControlName(n))&&this.otpForm.get(this.getControlName(n)).setValue(e)}),this.config.disableAutoFocus||setTimeout(()=>{let e=this.document.getElementById(`c_${this.componentKey}`);var n=t.length<this.config.length?t.length:this.config.length-1;let i=e.getElementsByClassName("otp-input")[n];i&&i.focus&&setTimeout(()=>{i.focus()},1)},0),this.rebuildValue()}}rebuildValue(){let t=null;w.keys(this.otpForm.controls).forEach(e=>{let n=this.otpForm.controls[e].value;if(n){let i=n.length>1,d=!this.config.allowNumbersOnly&&this.config.letterCase&&(this.config.letterCase.toLocaleLowerCase()=="upper"||this.config.letterCase.toLocaleLowerCase()=="lower");n=n[0];let y=d?this.config.letterCase.toLocaleLowerCase()=="upper"?n.toUpperCase():n.toLowerCase():n;d&&y==n?d=!1:n=y,t==null?t=n:t+=n,(i||d)&&this.otpForm.controls[e].setValue(n)}}),this.currentVal!=t&&(this.currentVal=t,this.onChange(t),this.formCtrl?.setValue&&this.formCtrl.setValue(t),this.onInputChange.next(t))}handlePaste(t){let e=t.clipboardData||window.clipboardData;if(e)var n=e.getData("Text");t.stopPropagation(),t.preventDefault(),!(!n||this.config.allowNumbersOnly&&!this.validateNumber(n))&&this.setValue(n)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(e){return new(e||r)(u(X),u(U))}}static{this.\u0275cmp=b({type:r,selectors:[["ng-otp-input"],["ngx-otp-input"]],inputs:{config:"config",formCtrl:"formCtrl",disabled:"disabled"},outputs:{onBlur:"onBlur",onInputChange:"onInputChange"},features:[Z([{provide:rt,useExisting:z(()=>r),multi:!0}])],decls:1,vars:1,consts:[["inp",""],["tabindex","0",3,"class","id","ngStyle","focusin","focusout",4,"ngIf"],["tabindex","0",3,"focusin","focusout","id","ngStyle"],[1,"n-o-c"],[4,"ngFor","ngForOf"],["autocomplete","one-time-code",3,"paste","keyup","input","keydown","pattern","type","placeholder","ngStyle","formControl","id","ngClass"],[4,"ngIf"]],template:function(e,n){e&1&&v(0,Vt,3,7,"div",1),e&2&&p("ngIf",n.otpForm==null?null:n.otpForm.controls)},dependencies:[E,N,T,_t,ut,I,tt,et,$],styles:[".otp-input[_ngcontent-%COMP%]{width:50px;height:50px;border-radius:4px;border:solid 1px #c5c5c5;text-align:center;font-size:32px}.ng-otp-input-wrapper[_ngcontent-%COMP%]   .otp-input[_ngcontent-%COMP%]{margin:0 .51rem}.ng-otp-input-wrapper[_ngcontent-%COMP%]   .otp-input[_ngcontent-%COMP%]:first-child{margin-left:0}.ng-otp-input-wrapper[_ngcontent-%COMP%]   .otp-input[_ngcontent-%COMP%]:last-child{margin-right:0}.n-o-c[_ngcontent-%COMP%]{display:flex;align-items:center}.error-input[_ngcontent-%COMP%]{border-color:red}@media screen and (max-width: 767px){.otp-input[_ngcontent-%COMP%]{width:40px;font-size:24px;height:40px}}@media screen and (max-width: 420px){.otp-input[_ngcontent-%COMP%]{width:30px;font-size:18px;height:30px}}"]})}}return r})(),St=(()=>{class r{static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275mod=H({type:r})}static{this.\u0275inj=G({imports:[B]})}}return r})();function At(r,o){if(r&1&&(a(0,"span"),l(1," Resend OTP in "),a(2,"strong"),l(3),s(),l(4,"s "),s()),r&2){let t=m();c(3),A(t.countdown)}}function Bt(r,o){if(r&1){let t=x();a(0,"a",11),g("click",function(){f(t);let n=m();return h(n.handleResend())}),l(1," Resend OTP "),s()}}var k=class r{constructor(o,t,e){this.authService=o;this.dialogRef=t;this.data=e;this.startTimer()}verified=new D;showToast=new D;otpCode="";countdown=60;canResend=!1;timerSub;baseUrl=V.baseUrl;config={length:6,inputClass:"otp-input",allowNumbersOnly:!0,isPasswordInput:!1,autofocus:!0,placeholder:""};startTimer(){this.countdown=240,this.canResend=!1,this.timerSub?.unsubscribe(),this.timerSub=j(1e3).subscribe(()=>{this.countdown--,this.countdown<=0&&(this.canResend=!0,this.timerSub.unsubscribe())})}onOtpChange(o){this.otpCode=o}handleSubmit(){if(this.otpCode.length!==6){this.showToast.emit("Please enter the full 6-digit OTP");return}this.authService.verifyOtp({phone:this.data.phone,otp:this.otpCode}).subscribe({next:()=>{this.verified.emit(),this.dialogRef.close()},error:()=>{this.showToast.emit("Invalid OTP")}})}handleResend(){this.canResend&&this.authService.resendOtp({phone:this.data.phone}).subscribe(()=>{this.showToast.emit("OTP resent successfully"),this.otpCode="",this.startTimer()})}ngOnDestroy(){this.timerSub?.unsubscribe()}get phone(){return this.data.phone}get type(){return this.data.type}static \u0275fac=function(t){return new(t||r)(u(F),u(yt),u(Ot))};static \u0275cmp=b({type:r,selectors:[["app-otp-modal"]],outputs:{verified:"verified",showToast:"showToast"},decls:17,vars:5,consts:[[1,"otp-modal-backdrop"],[1,"otp-modal"],[1,"close-btn",3,"click"],[1,"title"],[1,"subtitle"],[1,"phone"],[3,"onInputChange","config"],[1,"resend-section"],[4,"ngIf"],["class","resend-link",3,"click",4,"ngIf"],["type","button",1,"verify-btn",3,"click","disabled"],[1,"resend-link",3,"click"]],template:function(t,e){t&1&&(a(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return e.dialogRef.close()}),l(3,"\xD7"),s(),a(4,"h2",3),l(5,"Enter OTP"),s(),a(6,"p",4),l(7," We've sent a 6-digit verification code to "),a(8,"span",5),l(9),s(),l(10,". "),s(),a(11,"ng-otp-input",6),g("onInputChange",function(i){return e.onOtpChange(i)}),s(),a(12,"div",7),v(13,At,5,1,"span",8)(14,Bt,2,0,"a",9),s(),a(15,"button",10),g("click",function(){return e.handleSubmit()}),l(16," Verify "),s()()()),t&2&&(c(9),A(e.phone),c(2),p("config",e.config),c(2),p("ngIf",!e.canResend),c(),p("ngIf",e.canResend),c(),p("disabled",e.otpCode.length<6))},dependencies:[P,I,vt,St,B],encapsulation:2})};var It=class r{constructor(o,t,e,n,i){this.fb=o;this.authService=t;this.router=e;this.toast=n;this.dialog=i;this.registerForm=this.fb.group({name:["",_.required],email:["",[_.required,_.email]],phone:["",_.required],password:["",_.required],role:["user",_.required]})}registerForm;isSubmitting=!1;baseUrl=V.baseUrl;handleSubmit(){this.registerForm.invalid||(this.isSubmitting=!0,this.authService.register(this.registerForm.value).pipe(L(o=>(this.isSubmitting=!1,this.toast.error(o?.error?.message||"Registration failed"),K(null)))).subscribe(o=>{if(this.isSubmitting=!1,o?.user){this.toast.success("Registration successful. Please verify your phone number.");let t=this.dialog.open(k,{data:{phone:o.user.phone,type:"registration"},disableClose:!0,width:"700px"});t.componentInstance.verified.subscribe(()=>{this.toast.success("Your account has been verified."),this.router.navigate(["/login"])}),t.componentInstance.showToast.subscribe(e=>{this.toast.show(e)})}}))}onOtpSuccess(){this.toast.success("Your account has been verified."),this.router.navigate(["/login"])}onToast(o){this.toast.show(o)}static \u0275fac=function(t){return new(t||r)(u(bt),u(F),u(nt),u(wt),u(xt))};static \u0275cmp=b({type:r,selectors:[["app-register"]],decls:38,vars:3,consts:[[1,"register-container"],[1,"register-card"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","username"],["id","name","type","text","formControlName","name","placeholder","Enter your name","required",""],["for","email"],["id","email","type","email","formControlName","email","placeholder","Enter your email","required",""],["for","phone"],["id","phone","type","tel","formControlName","phone","placeholder","Enter your phone number","required",""],["for","password"],["id","password","type","password","formControlName","password","placeholder","Create a password","required",""],["for","role"],["id","role","formControlName","role","required",""],["value","user"],["value","artisan"],["type","submit",3,"disabled"],[1,"footer-text"],["routerLink","/login"]],template:function(t,e){t&1&&(a(0,"div",0)(1,"div",1)(2,"h2"),l(3,"Create an account"),s(),a(4,"p",2),l(5,"Join CraftConnect to find work or hire skilled artisans"),s(),a(6,"form",3),g("ngSubmit",function(){return e.handleSubmit()}),a(7,"div",4)(8,"label",5),l(9,"Name"),s(),O(10,"input",6),s(),a(11,"div",4)(12,"label",7),l(13,"Email"),s(),O(14,"input",8),s(),a(15,"div",4)(16,"label",9),l(17,"Phone Number"),s(),O(18,"input",10),s(),a(19,"div",4)(20,"label",11),l(21,"Password"),s(),O(22,"input",12),s(),a(23,"div",4)(24,"label",13),l(25,"Registering as"),s(),a(26,"select",14)(27,"option",15),l(28,"User"),s(),a(29,"option",16),l(30,"Artisan"),s()()(),a(31,"button",17),l(32),s()(),a(33,"div",18)(34,"span"),l(35,"Already have an account?"),s(),a(36,"a",19),l(37,"Sign in"),s()()()()),t&2&&(c(6),p("formGroup",e.registerForm),c(25),p("disabled",e.isSubmitting),c(),S(" ",e.isSubmitting?"Submitting...":"Register"," "))},dependencies:[P,ot,it,E,pt,ft,ht,N,gt,T,at,Ct,mt,dt],styles:[".register-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem 1rem;background-color:#f9fafb;min-height:100vh}.register-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background-color:#fff;padding:2rem;border-radius:.5rem;box-shadow:0 2px 8px #0000001a}.register-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:1.75rem;font-weight:600;margin-bottom:.5rem}.register-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{text-align:center;font-size:.95rem;color:#6b7280;margin-bottom:1.5rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:#374151;margin-bottom:.25rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.95rem;outline:none;transition:border-color .2s}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem;accent-color:#3b82f6}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.85rem;color:#374151}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:.5rem;border:none;border-radius:.375rem;font-weight:600;cursor:pointer;transition:background-color .2s}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;font-size:.875rem;color:#6b7280}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-weight:500}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline;color:#1d4ed8}"]})};export{It as RegisterComponent};
