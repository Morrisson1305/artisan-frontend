import{k as u}from"./chunk-INCWKMBU.js";import{Fb as g,P as h,S as s,X as a,qa as n}from"./chunk-PPTO45QW.js";var c={production:!0,baseUrl:"https://craft-connect-8b51661d10bb.herokuapp.com/api/v1"};var o=class r{userKey="auth_user";accessTokenKey="access_token";refreshTokenKey="refresh_token";getUser(){let e=localStorage.getItem(this.userKey);return e?JSON.parse(e):null}setUser(e){localStorage.setItem(this.userKey,JSON.stringify(e))}setTokens(e,t){localStorage.setItem(this.accessTokenKey,e),localStorage.setItem(this.refreshTokenKey,t)}getAccessToken(){return localStorage.getItem(this.accessTokenKey)}getRefreshToken(){return localStorage.getItem(this.refreshTokenKey)}clear(){localStorage.removeItem(this.userKey),localStorage.removeItem(this.accessTokenKey),localStorage.removeItem(this.refreshTokenKey)}isTokenExpired(e){if(!e)return!0;try{let t=JSON.parse(atob(e.split(".")[1])),i=Math.floor(Date.now()/1e3);return t.exp&&t.exp<i}catch{return!0}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var p=class r{constructor(e,t){this.authStorage=e;this.http=t;let i=this.authStorage.getUser(),l=this.authStorage.getAccessToken();l&&!this.authStorage.isTokenExpired(l)?this.user.set(i):(this.authStorage.clear(),this.user.set(null)),this.isLoading.set(!1)}user=n(null);isLoading=n(!0);baseUrl=c.baseUrl;login(e){return this.http.post(`${this.baseUrl}/auth/login`,e)}verifyLoginOtp(e){return this.http.post(`${this.baseUrl}/auth/login/verify`,e).pipe(h(t=>{this.authStorage.setUser(t.user),this.authStorage.setTokens(t.accessToken,t.refreshToken),this.user.set(t.user)}))}register(e){return this.http.post(`${this.baseUrl}/auth/register`,e)}verifyOtp(e){return this.http.post(`${this.baseUrl}/auth/verify-otp`,e)}resendOtp(e){return this.http.post(`${this.baseUrl}/auth/resend-otp`,e)}logout(){this.authStorage.clear(),this.user.set(null)}get authState(){return g(()=>({user:this.user(),isAuthenticated:!!this.user(),isLoading:this.isLoading()}))}getUser(){return this.user()}getAccessToken(){return this.authStorage.getAccessToken()}getRefreshToken(){return this.authStorage.getRefreshToken()}static \u0275fac=function(t){return new(t||r)(a(o),a(u))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};export{c as a,o as b,p as c};
