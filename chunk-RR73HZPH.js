import{a as z}from"./chunk-J2WORN5V.js";import{L as q,b as T,c as u,e as F,f as E,i as I,k as L,l as U,p as A,r as N,t as j}from"./chunk-IK7H7RIM.js";import{a as R}from"./chunk-7NFSDECY.js";import{b as k,f as x}from"./chunk-KO2BALJS.js";import{Da as l,Db as S,Ia as m,Oa as O,P as f,Rb as w,S as v,Sa as d,Tb as y,X as h,Za as g,cb as r,db as i,eb as C,jb as P,kb as M,qa as _,sb as s,ub as b}from"./chunk-DWD5OEKV.js";var p=class o{constructor(n,e){this.authStorage=n;this.http=e;let t=this.authStorage.getUser(),a=this.authStorage.getAccessToken();a&&!this.authStorage.isTokenExpired(a)?this.user.set(t):(this.authStorage.clear(),this.user.set(null)),this.isLoading.set(!1)}user=_(null);isLoading=_(!0);baseUrl=R.baseUrl;login(n){return this.http.post(`${this.baseUrl}/auth/login`,n).pipe(f(e=>{this.authStorage.setUser(e.user),this.authStorage.setTokens(e.accessToken,e.refreshToken),this.user.set(e.user)}))}register(n){return this.http.post(`${this.baseUrl}/auth/register`,n)}verifyOtp(n){return this.http.post(`${this.baseUrl}/auth/verify-otp`,n).pipe(f(e=>{this.authStorage.setUser(e.user),this.authStorage.setTokens(e.accessToken,e.refreshToken),this.user.set(e.user)}))}resendOtp(n){return this.http.post(`${this.baseUrl}/auth/resend-otp`,n)}logout(){this.authStorage.clear(),this.user.set(null)}get authState(){return S(()=>({user:this.user(),isAuthenticated:!!this.user(),isLoading:this.isLoading()}))}getUser(){return this.user()}getAccessToken(){return this.authStorage.getAccessToken()}getRefreshToken(){return this.authStorage.getRefreshToken()}static \u0275fac=function(e){return new(e||o)(h(z),h(k))};static \u0275prov=v({token:o,factory:o.\u0275fac,providedIn:"root"})};function $(o,n){o&1&&(r(0,"small"),s(1,"Email is required."),i())}function H(o,n){o&1&&(r(0,"small"),s(1,"Invalid email format."),i())}function B(o,n){if(o&1&&(r(0,"div",15),d(1,$,2,0,"small",16)(2,H,2,0,"small",16),i()),o&2){let e,t,a=M();l(),g("ngIf",(e=a.loginForm.get("email"))==null||e.errors==null?null:e.errors.required),l(),g("ngIf",(t=a.loginForm.get("email"))==null||t.errors==null?null:t.errors.email)}}function Y(o,n){o&1&&(r(0,"div",15)(1,"small"),s(2,"Password is required."),i()())}var V=class o{constructor(n,e,t,a){this.fb=n;this.authService=e;this.toast=t;this.router=a;this.loginForm=this.fb.group({phone:["",[u.required,u.pattern(/^[0-9]{10,15}$/)]],password:["",[u.required]]})}loginForm;loginPending=!1;showPassword=!1;togglePasswordVisibility(){this.showPassword=!this.showPassword}handleSubmit(){if(this.loginForm.invalid)return;this.loginPending=!0;let{phone:n,password:e}=this.loginForm.value;this.authService.login({phone:n,password:e}).subscribe({next:t=>{this.toast.success("Welcome back! You have been successfully logged in."),t.user?.isArtisan?this.router.navigate(["/artisan-dashboard"]):this.router.navigate(["/user-dashboard"])},error:t=>{this.toast.error("Login failed or Invalid credentials")},complete:()=>{this.loginPending=!1}})}static \u0275fac=function(e){return new(e||o)(m(N),m(p),m(q),m(x))};static \u0275cmp=O({type:o,selectors:[["app-login"]],decls:27,vars:7,consts:[[1,"login-container"],[1,"login-card"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","email"],["id","email","type","email","formControlName","email","placeholder","Enter your email","required",""],["class","error",4,"ngIf"],["for","password"],[1,"password-wrapper"],["id","password","formControlName","password","placeholder","Enter your password","required","",3,"type"],["type","button",1,"toggle-password",3,"click"],["type","submit",3,"disabled"],[1,"footer-text"],["routerLink","/register"],[1,"error"],[4,"ngIf"]],template:function(e,t){if(e&1&&(r(0,"div",0)(1,"div",1)(2,"h2"),s(3,"Sign in"),i(),r(4,"p",2),s(5,"Enter your credentials to access your account"),i(),r(6,"form",3),P("ngSubmit",function(){return t.handleSubmit()}),r(7,"div",4)(8,"label",5),s(9,"Email"),i(),C(10,"input",6),d(11,B,3,2,"div",7),i(),r(12,"div",4)(13,"label",8),s(14,"Password"),i(),r(15,"div",9),C(16,"input",10),r(17,"button",11),P("click",function(){return t.showPassword=!t.showPassword}),s(18),i()(),d(19,Y,3,0,"div",7),i(),r(20,"button",12),s(21),i()(),r(22,"div",13)(23,"span"),s(24,"Don't have an account? "),i(),r(25,"a",14),s(26,"Sign up"),i()()()()),e&2){let a,c;l(6),g("formGroup",t.loginForm),l(5),g("ngIf",((a=t.loginForm.get("email"))==null?null:a.touched)&&((a=t.loginForm.get("email"))==null?null:a.invalid)),l(5),g("type",t.showPassword?"text":"password"),l(2),b(" ",t.showPassword?"Hide":"Show"," "),l(),g("ngIf",((c=t.loginForm.get("password"))==null?null:c.touched)&&((c=t.loginForm.get("password"))==null?null:c.invalid)),l(),g("disabled",t.loginPending||t.loginForm.invalid),l(),b(" ",t.loginPending?"Signing in...":"Sign in"," ")}},dependencies:[y,w,j,I,T,F,E,A,L,U],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem 1rem;background-color:#f9fafb;min-height:100vh}.login-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background-color:#fff;padding:2rem;border-radius:.5rem;box-shadow:0 2px 8px #0000001a}.login-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:1.75rem;font-weight:600;margin-bottom:.5rem}.login-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{text-align:center;font-size:.95rem;color:#6b7280;margin-bottom:1.5rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:#374151;margin-bottom:.25rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.95rem;outline:none;transition:border-color .2s}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]{position:relative}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding-right:4rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]   .toggle-password[_ngcontent-%COMP%]{position:absolute;top:50%;right:.75rem;transform:translateY(-50%);background:none;border:none;color:#2563eb;font-size:.85rem;cursor:pointer}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{margin-top:.25rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#dc2626;font-size:.8rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:.5rem;border:none;border-radius:.375rem;font-weight:600;cursor:pointer;transition:background-color .2s}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;font-size:.875rem;color:#6b7280}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-weight:500}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline;color:#1d4ed8}"]})};export{V as LoginComponent};
