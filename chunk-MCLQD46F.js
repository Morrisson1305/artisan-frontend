import{a as q,b as p,c as j,d as V,e as G,f as z,g as U,h as B,i as L,j as Y,k as H,l as J,m as W,n as K,o as Q,p as X,q as Z,r as $,s as ee,u as te}from"./chunk-JN6MCTHP.js";import{a as h,c as b}from"./chunk-5VSC257S.js";import{a as F,b as A}from"./chunk-2ITC4HNE.js";import{f as I,h as f,o as k,p as N,s as D}from"./chunk-INCWKMBU.js";import{A as x,Da as a,Ia as m,Oa as g,Sa as E,Za as l,ca as y,cb as t,da as w,db as e,eb as c,hb as R,jb as d,kb as _,l as S,la as v,sb as n,tb as O,ub as T,w as P}from"./chunk-PPTO45QW.js";function se(s,r){if(s&1&&(t(0,"span"),n(1," Resend OTP in "),t(2,"strong"),n(3),e(),n(4,"s "),e()),s&2){let i=_();a(3),O(i.countdown)}}function me(s,r){if(s&1){let i=R();t(0,"a",11),d("click",function(){y(i);let u=_();return w(u.handleResend())}),n(1," Resend OTP "),e()}}var C=class s{constructor(r,i,o){this.authService=r;this.dialogRef=i;this.data=o;this.startTimer()}verified=new v;showToast=new v;otpCode="";countdown=60;canResend=!1;timerSub;baseUrl=h.baseUrl;config={length:6,inputClass:"otp-input",allowNumbersOnly:!0,isPasswordInput:!1,autofocus:!0,placeholder:""};startTimer(){this.countdown=240,this.canResend=!1,this.timerSub?.unsubscribe(),this.timerSub=P(1e3).subscribe(()=>{this.countdown--,this.countdown<=0&&(this.canResend=!0,this.timerSub.unsubscribe())})}onOtpChange(r){this.otpCode=r}handleSubmit(){if(this.otpCode.length!==6){this.showToast.emit("Please enter the full 6-digit OTP");return}this.authService.verifyOtp({phone:this.data.phone,otp:this.otpCode}).subscribe({next:()=>{this.verified.emit(),this.dialogRef.close()},error:()=>{this.showToast.emit("Invalid OTP")}})}handleResend(){this.canResend&&this.authService.resendOtp({phone:this.data.phone}).subscribe(()=>{this.showToast.emit("OTP resent successfully"),this.otpCode="",this.startTimer()})}ngOnDestroy(){this.timerSub?.unsubscribe()}get phone(){return this.data.phone}get type(){return this.data.type}static \u0275fac=function(i){return new(i||s)(m(b),m(Z),m($))};static \u0275cmp=g({type:s,selectors:[["app-otp-modal"]],outputs:{verified:"verified",showToast:"showToast"},decls:17,vars:5,consts:[[1,"otp-modal-backdrop"],[1,"otp-modal"],[1,"close-btn",3,"click"],[1,"title"],[1,"subtitle"],[1,"phone"],[3,"onInputChange","config"],[1,"resend-section"],[4,"ngIf"],["class","resend-link",3,"click",4,"ngIf"],["type","button",1,"verify-btn",3,"click","disabled"],[1,"resend-link",3,"click"]],template:function(i,o){i&1&&(t(0,"div",0)(1,"div",1)(2,"button",2),d("click",function(){return o.dialogRef.close()}),n(3,"\xD7"),e(),t(4,"h2",3),n(5,"Enter OTP"),e(),t(6,"p",4),n(7," We've sent a 6-digit verification code to "),t(8,"span",5),n(9),e(),n(10,". "),e(),t(11,"ng-otp-input",6),d("onInputChange",function(M){return o.onOtpChange(M)}),e(),t(12,"div",7),E(13,se,5,1,"span",8)(14,me,2,0,"a",9),e(),t(15,"button",10),d("click",function(){return o.handleSubmit()}),n(16," Verify "),e()()()),i&2&&(a(9),O(o.phone),a(2),l("config",o.config),a(2),l("ngIf",!o.canResend),a(),l("ngIf",o.canResend),a(),l("disabled",o.otpCode.length<6))},dependencies:[f,I,W,X,Q],encapsulation:2})};var ne=class s{constructor(r,i,o,u,M){this.fb=r;this.authService=i;this.router=o;this.toast=u;this.dialog=M;this.registerForm=this.fb.group({name:["",p.required],email:["",[p.required,p.email]],phone:["",p.required],password:["",p.required],role:["user",p.required]})}registerForm;isSubmitting=!1;baseUrl=h.baseUrl;handleSubmit(){this.registerForm.invalid||(this.isSubmitting=!0,this.authService.register(this.registerForm.value).pipe(x(r=>(this.isSubmitting=!1,this.toast.error(r?.error?.message||"Registration failed"),S(null)))).subscribe(r=>{if(this.isSubmitting=!1,r?.user){this.toast.success("Registration successful. Please verify your phone number.");let i=this.dialog.open(C,{data:{phone:r.user.phone,type:"registration"},disableClose:!0,width:"700px"});i.componentInstance.verified.subscribe(()=>{this.toast.success("Your account has been verified."),this.router.navigate(["/login"])}),i.componentInstance.showToast.subscribe(o=>{this.toast.show(o)})}}))}onOtpSuccess(){this.toast.success("Your account has been verified."),this.router.navigate(["/login"])}onToast(r){this.toast.show(r)}static \u0275fac=function(i){return new(i||s)(m(J),m(b),m(k),m(te),m(ee))};static \u0275cmp=g({type:s,selectors:[["app-register"]],decls:40,vars:3,consts:[[1,"register-container"],[1,"register-card"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","username"],["id","name","type","text","formControlName","name","placeholder","Enter your name","required",""],["for","email"],["id","email","type","email","formControlName","email","placeholder","Enter your email","required",""],["for","phone"],["id","phone","type","tel","formControlName","phone","placeholder","Enter your phone number","required",""],["for","password"],["id","password","type","password","formControlName","password","placeholder","Create a password","required",""],["for","role"],["id","role","formControlName","role","required",""],["value","user"],["value","artisan"],["type","submit",3,"disabled"],[1,"footer-text"],["routerLink","/login"]],template:function(i,o){i&1&&(c(0,"app-header"),t(1,"div",0)(2,"div",1)(3,"h2"),n(4,"Create an account"),e(),t(5,"p",2),n(6,"Join CraftConnect to find work or hire skilled artisans"),e(),t(7,"form",3),d("ngSubmit",function(){return o.handleSubmit()}),t(8,"div",4)(9,"label",5),n(10,"Name"),e(),c(11,"input",6),e(),t(12,"div",4)(13,"label",7),n(14,"Email"),e(),c(15,"input",8),e(),t(16,"div",4)(17,"label",9),n(18,"Phone Number"),e(),c(19,"input",10),e(),t(20,"div",4)(21,"label",11),n(22,"Password"),e(),c(23,"input",12),e(),t(24,"div",4)(25,"label",13),n(26,"Registering as"),e(),t(27,"select",14)(28,"option",15),n(29,"User"),e(),t(30,"option",16),n(31,"Artisan"),e()()(),t(32,"button",17),n(33),e()(),t(34,"div",18)(35,"span"),n(36,"Already have an account?"),e(),t(37,"a",19),n(38,"Sign in"),e()()()(),c(39,"app-footer")),i&2&&(a(7),l("formGroup",o.registerForm),a(25),l("disabled",o.isSubmitting),a(),T(" ",o.isSubmitting?"Submitting...":"Register"," "))},dependencies:[f,D,N,K,G,L,Y,q,B,j,V,H,z,U,F,A],styles:[".register-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem 1rem;background-color:#f9fafb;min-height:100vh}.register-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background-color:#fff;padding:2rem;border-radius:.5rem;box-shadow:0 2px 8px #0000001a}.register-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:1.75rem;font-weight:600;margin-bottom:.5rem}.register-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{text-align:center;font-size:.95rem;color:#6b7280;margin-bottom:1.5rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:#374151;margin-bottom:.25rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.95rem;outline:none;transition:border-color .2s}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem;accent-color:#3b82f6}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.85rem;color:#374151}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:.5rem;border:none;border-radius:.375rem;font-weight:600;cursor:pointer;transition:background-color .2s}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;font-size:.875rem;color:#6b7280}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-weight:500}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline;color:#1d4ed8}"]})};export{ne as RegisterComponent};
