import{a as F,b as d,c as A,d as q,e as j,f as V,g as G,h as z,i as U,j as B,k as L,l as Y,m as H,n as J,o as W,p as K,q as Q,r as X,s as Z,u as $}from"./chunk-PZVRPNO4.js";import{a as b}from"./chunk-N35DKANW.js";import{a as h}from"./chunk-TKIRZA44.js";import{f as k,g as N,j as D}from"./chunk-ZUXIL7TL.js";import{$b as f,A as x,Da as a,Ia as l,Oa as g,Sa as E,Xb as I,Za as m,ca as y,cb as t,da as w,db as e,eb as u,hb as R,jb as c,kb as _,l as S,la as v,tb as n,ub as O,vb as T,w as P}from"./chunk-EUQM6YRV.js";function re(s,r){if(s&1&&(t(0,"span"),n(1," Resend OTP in "),t(2,"strong"),n(3),e(),n(4,"s "),e()),s&2){let i=_();a(3),O(i.countdown)}}function ae(s,r){if(s&1){let i=R();t(0,"a",11),c("click",function(){y(i);let p=_();return w(p.handleResend())}),n(1," Resend OTP "),e()}}var C=class s{constructor(r,i,o){this.authService=r;this.dialogRef=i;this.data=o;this.startTimer()}verified=new v;showToast=new v;otpCode="";countdown=60;canResend=!1;timerSub;baseUrl=h.baseUrl;config={length:6,inputClass:"otp-input",allowNumbersOnly:!0,isPasswordInput:!1,autofocus:!0,placeholder:""};startTimer(){this.countdown=240,this.canResend=!1,this.timerSub?.unsubscribe(),this.timerSub=P(1e3).subscribe(()=>{this.countdown--,this.countdown<=0&&(this.canResend=!0,this.timerSub.unsubscribe())})}onOtpChange(r){this.otpCode=r}handleSubmit(){if(this.otpCode.length!==6){this.showToast.emit("Please enter the full 6-digit OTP");return}this.authService.verifyOtp({phone:this.data.phone,otp:this.otpCode}).subscribe({next:()=>{this.verified.emit(),this.dialogRef.close()},error:()=>{this.showToast.emit("Invalid OTP")}})}handleResend(){this.canResend&&this.authService.resendOtp({phone:this.data.phone}).subscribe(()=>{this.showToast.emit("OTP resent successfully"),this.otpCode="",this.startTimer()})}ngOnDestroy(){this.timerSub?.unsubscribe()}get phone(){return this.data.phone}get type(){return this.data.type}static \u0275fac=function(i){return new(i||s)(l(b),l(Q),l(X))};static \u0275cmp=g({type:s,selectors:[["app-otp-modal"]],outputs:{verified:"verified",showToast:"showToast"},decls:17,vars:5,consts:[[1,"otp-modal-backdrop"],[1,"otp-modal"],[1,"close-btn",3,"click"],[1,"title"],[1,"subtitle"],[1,"phone"],[3,"onInputChange","config"],[1,"resend-section"],[4,"ngIf"],["class","resend-link",3,"click",4,"ngIf"],["type","button",1,"verify-btn",3,"click","disabled"],[1,"resend-link",3,"click"]],template:function(i,o){i&1&&(t(0,"div",0)(1,"div",1)(2,"button",2),c("click",function(){return o.dialogRef.close()}),n(3,"\xD7"),e(),t(4,"h2",3),n(5,"Enter OTP"),e(),t(6,"p",4),n(7," We've sent a 6-digit verification code to "),t(8,"span",5),n(9),e(),n(10,". "),e(),t(11,"ng-otp-input",6),c("onInputChange",function(M){return o.onOtpChange(M)}),e(),t(12,"div",7),E(13,re,5,1,"span",8)(14,ae,2,0,"a",9),e(),t(15,"button",10),c("click",function(){return o.handleSubmit()}),n(16," Verify "),e()()()),i&2&&(a(9),O(o.phone),a(2),m("config",o.config),a(2),m("ngIf",!o.canResend),a(),m("ngIf",o.canResend),a(),m("disabled",o.otpCode.length<6))},dependencies:[f,I,H,K,W],encapsulation:2})};var ee=class s{constructor(r,i,o,p,M){this.fb=r;this.authService=i;this.router=o;this.toast=p;this.dialog=M;this.registerForm=this.fb.group({name:["",d.required],email:["",[d.required,d.email]],phone:["",d.required],password:["",d.required],role:["user",d.required]})}registerForm;isSubmitting=!1;baseUrl=h.baseUrl;handleSubmit(){this.registerForm.invalid||(this.isSubmitting=!0,this.authService.register(this.registerForm.value).pipe(x(r=>(this.isSubmitting=!1,this.toast.error(r?.error?.message||"Registration failed"),S(null)))).subscribe(r=>{if(this.isSubmitting=!1,r?.user){this.toast.success("Registration successful. Please verify your phone number.");let i=this.dialog.open(C,{data:{phone:r.user.phone,type:"registration"},disableClose:!0,width:"700px"});i.componentInstance.verified.subscribe(()=>{this.toast.success("Your account has been verified."),this.router.navigate(["/login"])}),i.componentInstance.showToast.subscribe(o=>{this.toast.show(o)})}}))}onOtpSuccess(){this.toast.success("Your account has been verified."),this.router.navigate(["/login"])}onToast(r){this.toast.show(r)}static \u0275fac=function(i){return new(i||s)(l(Y),l(b),l(k),l($),l(Z))};static \u0275cmp=g({type:s,selectors:[["app-register"]],decls:38,vars:3,consts:[[1,"register-container"],[1,"register-card"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","username"],["id","name","type","text","formControlName","name","placeholder","Enter your name","required",""],["for","email"],["id","email","type","email","formControlName","email","placeholder","Enter your email","required",""],["for","phone"],["id","phone","type","tel","formControlName","phone","placeholder","Enter your phone number","required",""],["for","password"],["id","password","type","password","formControlName","password","placeholder","Create a password","required",""],["for","role"],["id","role","formControlName","role","required",""],["value","user"],["value","artisan"],["type","submit",3,"disabled"],[1,"footer-text"],["routerLink","/login"]],template:function(i,o){i&1&&(t(0,"div",0)(1,"div",1)(2,"h2"),n(3,"Create an account"),e(),t(4,"p",2),n(5,"Join CraftConnect to find work or hire skilled artisans"),e(),t(6,"form",3),c("ngSubmit",function(){return o.handleSubmit()}),t(7,"div",4)(8,"label",5),n(9,"Name"),e(),u(10,"input",6),e(),t(11,"div",4)(12,"label",7),n(13,"Email"),e(),u(14,"input",8),e(),t(15,"div",4)(16,"label",9),n(17,"Phone Number"),e(),u(18,"input",10),e(),t(19,"div",4)(20,"label",11),n(21,"Password"),e(),u(22,"input",12),e(),t(23,"div",4)(24,"label",13),n(25,"Registering as"),e(),t(26,"select",14)(27,"option",15),n(28,"User"),e(),t(29,"option",16),n(30,"Artisan"),e()()(),t(31,"button",17),n(32),e()(),t(33,"div",18)(34,"span"),n(35,"Already have an account?"),e(),t(36,"a",19),n(37,"Sign in"),e()()()()),i&2&&(a(6),m("formGroup",o.registerForm),a(25),m("disabled",o.isSubmitting),a(),T(" ",o.isSubmitting?"Submitting...":"Register"," "))},dependencies:[f,D,N,J,j,U,B,F,z,A,q,L,V,G],styles:[".register-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem 1rem;background-color:#f9fafb;min-height:100vh}.register-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background-color:#fff;padding:2rem;border-radius:.5rem;box-shadow:0 2px 8px #0000001a}.register-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:1.75rem;font-weight:600;margin-bottom:.5rem}.register-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{text-align:center;font-size:.95rem;color:#6b7280;margin-bottom:1.5rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:#374151;margin-bottom:.25rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.95rem;outline:none;transition:border-color .2s}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem;accent-color:#3b82f6}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.85rem;color:#374151}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:.5rem;border:none;border-radius:.375rem;font-weight:600;cursor:pointer;transition:background-color .2s}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;font-size:.875rem;color:#6b7280}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-weight:500}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline;color:#1d4ed8}"]})};export{ee as RegisterComponent};
