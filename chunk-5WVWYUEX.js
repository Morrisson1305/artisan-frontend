import{a as ee,b as te}from"./chunk-RQFDSKF6.js";import{R as J,S as W,T as $,b as D,c as d,da as C,e as A,ea as K,f as q,fa as v,j,m as V,n as X,o as z,p as G,q as U,r as B,t as L,u as Y,v as H}from"./chunk-QCKMTWOB.js";import{a as Q,b as Z}from"./chunk-6VP3MAXX.js";import{f as b,k as _,s as k,t as N,w as F}from"./chunk-QMK46LHX.js";import{D as w,Ib as n,Jb as S,Kb as T,Ma as l,Ra as c,Ya as h,cb as g,ia as E,ja as I,kb as m,o as x,pb as t,qb as e,rb as p,sa as M,ub as R,wb as u,xb as f,z as y}from"./chunk-HI7HT6SX.js";function le(a,r){if(a&1&&(t(0,"span"),n(1," Resend OTP in "),t(2,"strong"),n(3),e(),n(4,"s "),e()),a&2){let o=f();l(3),S(o.countdown)}}function me(a,r){if(a&1){let o=R();t(0,"a",11),u("click",function(){E(o);let s=f();return I(s.handleResend())}),n(1," Resend OTP "),e()}}var O=class a{constructor(r,o,i){this.authService=r;this.dialogRef=o;this.data=i;this.startTimer()}verified=new M;showToast=new M;otpCode="";countdown=60;canResend=!1;timerSub;baseUrl=C.baseUrl;config={length:6,inputClass:"otp-input",allowNumbersOnly:!0,isPasswordInput:!1,autofocus:!0,placeholder:""};startTimer(){this.countdown=240,this.canResend=!1,this.timerSub?.unsubscribe(),this.timerSub=y(1e3).subscribe(()=>{this.countdown--,this.countdown<=0&&(this.canResend=!0,this.timerSub.unsubscribe())})}onOtpChange(r){this.otpCode=r}handleSubmit(){if(this.otpCode.length!==6){this.showToast.emit("Please enter the full 6-digit OTP");return}this.authService.verifyOtp({phone:this.data.phone,otp:this.otpCode}).subscribe({next:()=>{this.verified.emit(),this.dialogRef.close()},error:()=>{this.showToast.emit("Invalid OTP")}})}handleResend(){this.canResend&&this.authService.resendOtp({phone:this.data.phone}).subscribe(()=>{this.showToast.emit("OTP resent successfully"),this.otpCode="",this.startTimer()})}ngOnDestroy(){this.timerSub?.unsubscribe()}get phone(){return this.data.phone}get type(){return this.data.type}static \u0275fac=function(o){return new(o||a)(c(v),c(J),c(W))};static \u0275cmp=h({type:a,selectors:[["app-otp-modal"]],outputs:{verified:"verified",showToast:"showToast"},decls:17,vars:5,consts:[[1,"otp-modal-backdrop"],[1,"otp-modal"],[1,"close-btn",3,"click"],[1,"title"],[1,"subtitle"],[1,"phone"],[3,"onInputChange","config"],[1,"resend-section"],[4,"ngIf"],["class","resend-link",3,"click",4,"ngIf"],["type","button",1,"verify-btn",3,"click","disabled"],[1,"resend-link",3,"click"]],template:function(o,i){o&1&&(t(0,"div",0)(1,"div",1)(2,"button",2),u("click",function(){return i.dialogRef.close()}),n(3,"\xD7"),e(),t(4,"h2",3),n(5,"Enter OTP"),e(),t(6,"p",4),n(7," We've sent a 6-digit verification code to "),t(8,"span",5),n(9),e(),n(10,". "),e(),t(11,"ng-otp-input",6),u("onInputChange",function(P){return i.onOtpChange(P)}),e(),t(12,"div",7),g(13,le,5,1,"span",8)(14,me,2,0,"a",9),e(),t(15,"button",10),u("click",function(){return i.handleSubmit()}),n(16," Verify "),e()()()),o&2&&(l(9),S(i.phone),l(2),m("config",i.config),l(2),m("ngIf",!i.canResend),l(),m("ngIf",i.canResend),l(),m("disabled",i.otpCode.length<6))},dependencies:[_,b,Y,te,ee],encapsulation:2})};function ce(a,r){a&1&&(t(0,"small"),n(1," Phone number is required "),e())}function de(a,r){a&1&&(t(0,"small"),n(1," Must be in the format 233XXXXXXXXX "),e())}function pe(a,r){if(a&1&&(t(0,"div",21),g(1,ce,2,0,"small",22)(2,de,2,0,"small",22),e()),a&2){let o,i,s=f();l(),m("ngIf",(o=s.registerForm.get("phone"))==null||o.errors==null?null:o.errors.required),l(),m("ngIf",(i=s.registerForm.get("phone"))==null||i.errors==null?null:i.errors.pattern)}}var ne=class a{constructor(r,o,i,s,P){this.fb=r;this.authService=o;this.router=i;this.toast=s;this.dialog=P;this.registerForm=this.fb.group({name:["",d.required],email:["",[d.required,d.email]],phone:["",[d.required,d.pattern(/^233\d{9}$/)]],password:["",d.required],role:["user",d.required]})}registerForm;isSubmitting=!1;baseUrl=C.baseUrl;handleSubmit(){this.registerForm.invalid||(this.isSubmitting=!0,this.authService.register(this.registerForm.value).pipe(w(r=>(this.isSubmitting=!1,this.toast.error(r?.error?.message||"Registration failed"),x(null)))).subscribe(r=>{if(this.isSubmitting=!1,r?.user){this.toast.success("Registration successful. Please verify your phone number.");let o=this.dialog.open(O,{data:{phone:r.user.phone,type:"registration"},disableClose:!0,width:"700px"});o.componentInstance.verified.subscribe(()=>{this.toast.success("Your account has been verified."),this.router.navigate(["/login"])}),o.componentInstance.showToast.subscribe(i=>{this.toast.show(i)})}}))}onOtpSuccess(){this.toast.success("Your account has been verified."),this.router.navigate(["/login"])}onToast(r){this.toast.show(r)}static \u0275fac=function(o){return new(o||a)(c(L),c(v),c(k),c(K),c($))};static \u0275cmp=h({type:a,selectors:[["app-register"]],decls:41,vars:4,consts:[[1,"register-container"],[1,"register-card"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","username"],["id","name","type","text","formControlName","name","placeholder","Enter your name","required",""],["for","email"],["id","email","type","email","formControlName","email","placeholder","Enter your email","required",""],["for","phone"],["id","phone","type","tel","formControlName","phone","placeholder","233xxxx","required",""],["class","error",4,"ngIf"],["for","password"],["id","password","type","password","formControlName","password","placeholder","Create a password","required",""],["for","role"],["id","role","formControlName","role","required",""],["value","user"],["value","artisan"],["type","submit",3,"disabled"],[1,"footer-text"],["routerLink","/login"],[1,"error"],[4,"ngIf"]],template:function(o,i){if(o&1&&(p(0,"app-header"),t(1,"div",0)(2,"div",1)(3,"h2"),n(4,"Create an account"),e(),t(5,"p",2),n(6,"Join CraftConnect to find work or hire skilled artisans"),e(),t(7,"form",3),u("ngSubmit",function(){return i.handleSubmit()}),t(8,"div",4)(9,"label",5),n(10,"Name"),e(),p(11,"input",6),e(),t(12,"div",4)(13,"label",7),n(14,"Email"),e(),p(15,"input",8),e(),t(16,"div",4)(17,"label",9),n(18,"Phone Number"),e(),p(19,"input",10),g(20,pe,3,2,"div",11),e(),t(21,"div",4)(22,"label",12),n(23,"Password"),e(),p(24,"input",13),e(),t(25,"div",4)(26,"label",14),n(27,"Registering as"),e(),t(28,"select",15)(29,"option",16),n(30,"User"),e(),t(31,"option",17),n(32,"Artisan"),e()()(),t(33,"button",18),n(34),e()(),t(35,"div",19)(36,"span"),n(37,"Already have an account?"),e(),t(38,"a",20),n(39,"Sign in"),e()()()(),p(40,"app-footer")),o&2){let s;l(7),m("formGroup",i.registerForm),l(13),m("ngIf",((s=i.registerForm.get("phone"))==null?null:s.touched)&&((s=i.registerForm.get("phone"))==null?null:s.invalid)),l(13),m("disabled",i.registerForm.invalid||i.isSubmitting),l(),T(" ",i.isSubmitting?"Submitting...":"Register"," ")}},dependencies:[_,b,F,N,H,j,G,U,D,z,A,q,B,V,X,Q,Z],styles:[".register-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem 1rem;background-color:#f9fafb;min-height:100vh}.register-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background-color:#fff;padding:2rem;border-radius:.5rem;box-shadow:0 2px 8px #0000001a}.register-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:1.75rem;font-weight:600;margin-bottom:.5rem}.register-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{text-align:center;font-size:.95rem;color:#6b7280;margin-bottom:1.5rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:#374151;margin-bottom:.25rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.95rem;outline:none;transition:border-color .2s}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem;accent-color:#3b82f6}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.85rem;color:#374151}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:.5rem;border:none;border-radius:.375rem;font-weight:600;cursor:pointer;transition:background-color .2s}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.register-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;font-size:.875rem;color:#6b7280}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-weight:500}.register-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline;color:#1d4ed8}.error[_ngcontent-%COMP%]{color:red;font-size:.875rem;margin-top:4px}"]})};export{ne as RegisterComponent};
