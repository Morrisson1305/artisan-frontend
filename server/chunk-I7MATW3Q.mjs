import './polyfills.server.mjs';
import{L as R,M as q,b as I,c as p,e as F,f as U,i as E,k as L,l as A,p as N,r as K,t as j}from"./chunk-GFGQNG6D.mjs";import{e as T,k as x}from"./chunk-7RLAR6IJ.mjs";import{Fa as l,Ka as g,N as _,Q as d,Qa as M,Tb as y,Ua as u,V as v,bb as c,gb as o,hb as i,ib as P,lc as w,nb as b,nc as k,ob as S,pa as C,wb as a,yb as O}from"./chunk-6RE4WLN5.mjs";import"./chunk-X2SEQXRR.mjs";var f=class r{userKey="auth_user";accessTokenKey="access_token";refreshTokenKey="refresh_token";getUser(){let t=localStorage.getItem(this.userKey);return t?JSON.parse(t):null}setUser(t){localStorage.setItem(this.userKey,JSON.stringify(t))}setTokens(t,e){localStorage.setItem(this.accessTokenKey,t),localStorage.setItem(this.refreshTokenKey,e)}getAccessToken(){return localStorage.getItem(this.accessTokenKey)}getRefreshToken(){return localStorage.getItem(this.refreshTokenKey)}clear(){localStorage.removeItem(this.userKey),localStorage.removeItem(this.accessTokenKey),localStorage.removeItem(this.refreshTokenKey)}isTokenExpired(t){if(!t)return!0;try{let e=JSON.parse(atob(t.split(".")[1])),n=Math.floor(Date.now()/1e3);return e.exp&&e.exp<n}catch{return!0}}static \u0275fac=function(e){return new(e||r)};static \u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"})};var h=class r{constructor(t,e){this.authStorage=t;this.http=e;let n=this.authStorage.getUser(),s=this.authStorage.getAccessToken();s&&!this.authStorage.isTokenExpired(s)?this.user.set(n):(this.authStorage.clear(),this.user.set(null)),this.isLoading.set(!1)}user=C(null);isLoading=C(!0);baseUrl=R.baseUrl;login(t){return this.http.post(`${this.baseUrl}/auth/login`,t).pipe(_(e=>{this.authStorage.setUser(e.user),this.authStorage.setTokens(e.accessToken,e.refreshToken),this.user.set(e.user)}))}register(t){return this.http.post(`${this.baseUrl}/auth/register`,t)}verifyOtp(t){return this.http.post(`${this.baseUrl}/auth/verify-otp`,t).pipe(_(e=>{this.authStorage.setUser(e.user),this.authStorage.setTokens(e.accessToken,e.refreshToken),this.user.set(e.user)}))}resendOtp(t){return this.http.post(`${this.baseUrl}/auth/resend-otp`,t)}logout(){this.authStorage.clear(),this.user.set(null)}get authState(){return y(()=>({user:this.user(),isAuthenticated:!!this.user(),isLoading:this.isLoading()}))}getUser(){return this.user()}getAccessToken(){return this.authStorage.getAccessToken()}getRefreshToken(){return this.authStorage.getRefreshToken()}static \u0275fac=function(e){return new(e||r)(v(f),v(T))};static \u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"})};function $(r,t){r&1&&(o(0,"small"),a(1,"Email is required."),i())}function H(r,t){r&1&&(o(0,"small"),a(1,"Invalid email format."),i())}function B(r,t){if(r&1&&(o(0,"div",15),u(1,$,2,0,"small",16)(2,H,2,0,"small",16),i()),r&2){let e,n,s=S();l(),c("ngIf",(e=s.loginForm.get("email"))==null||e.errors==null?null:e.errors.required),l(),c("ngIf",(n=s.loginForm.get("email"))==null||n.errors==null?null:n.errors.email)}}function J(r,t){r&1&&(o(0,"div",15)(1,"small"),a(2,"Password is required."),i()())}var D=class r{constructor(t,e,n,s){this.fb=t;this.authService=e;this.toast=n;this.router=s;this.loginForm=this.fb.group({phone:["",[p.required,p.pattern(/^[0-9]{10,15}$/)]],password:["",[p.required]]})}loginForm;loginPending=!1;showPassword=!1;togglePasswordVisibility(){this.showPassword=!this.showPassword}handleSubmit(){if(this.loginForm.invalid)return;this.loginPending=!0;let{phone:t,password:e}=this.loginForm.value;this.authService.login({phone:t,password:e}).subscribe({next:n=>{this.toast.success("Welcome back! You have been successfully logged in."),n.user?.isArtisan?this.router.navigate(["/artisan-dashboard"]):this.router.navigate(["/user-dashboard"])},error:n=>{this.toast.error("Login failed or Invalid credentials")},complete:()=>{this.loginPending=!1}})}static \u0275fac=function(e){return new(e||r)(g(K),g(h),g(q),g(x))};static \u0275cmp=M({type:r,selectors:[["app-login"]],decls:27,vars:7,consts:[[1,"login-container"],[1,"login-card"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","email"],["id","email","type","email","formControlName","email","placeholder","Enter your email","required",""],["class","error",4,"ngIf"],["for","password"],[1,"password-wrapper"],["id","password","formControlName","password","placeholder","Enter your password","required","",3,"type"],["type","button",1,"toggle-password",3,"click"],["type","submit",3,"disabled"],[1,"footer-text"],["routerLink","/register"],[1,"error"],[4,"ngIf"]],template:function(e,n){if(e&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),a(3,"Sign in"),i(),o(4,"p",2),a(5,"Enter your credentials to access your account"),i(),o(6,"form",3),b("ngSubmit",function(){return n.handleSubmit()}),o(7,"div",4)(8,"label",5),a(9,"Email"),i(),P(10,"input",6),u(11,B,3,2,"div",7),i(),o(12,"div",4)(13,"label",8),a(14,"Password"),i(),o(15,"div",9),P(16,"input",10),o(17,"button",11),b("click",function(){return n.showPassword=!n.showPassword}),a(18),i()(),u(19,J,3,0,"div",7),i(),o(20,"button",12),a(21),i()(),o(22,"div",13)(23,"span"),a(24,"Don't have an account? "),i(),o(25,"a",14),a(26,"Sign up"),i()()()()),e&2){let s,m;l(6),c("formGroup",n.loginForm),l(5),c("ngIf",((s=n.loginForm.get("email"))==null?null:s.touched)&&((s=n.loginForm.get("email"))==null?null:s.invalid)),l(5),c("type",n.showPassword?"text":"password"),l(2),O(" ",n.showPassword?"Hide":"Show"," "),l(),c("ngIf",((m=n.loginForm.get("password"))==null?null:m.touched)&&((m=n.loginForm.get("password"))==null?null:m.invalid)),l(),c("disabled",n.loginPending||n.loginForm.invalid),l(),O(" ",n.loginPending?"Signing in...":"Sign in"," ")}},dependencies:[k,w,j,E,I,F,U,N,L,A],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem 1rem;background-color:#f9fafb;min-height:100vh}.login-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background-color:#fff;padding:2rem;border-radius:.5rem;box-shadow:0 2px 8px #0000001a}.login-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:1.75rem;font-weight:600;margin-bottom:.5rem}.login-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{text-align:center;font-size:.95rem;color:#6b7280;margin-bottom:1.5rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:#374151;margin-bottom:.25rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.95rem;outline:none;transition:border-color .2s}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]{position:relative}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding-right:4rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]   .toggle-password[_ngcontent-%COMP%]{position:absolute;top:50%;right:.75rem;transform:translateY(-50%);background:none;border:none;color:#2563eb;font-size:.85rem;cursor:pointer}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{margin-top:.25rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#dc2626;font-size:.8rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:.5rem;border:none;border-radius:.375rem;font-weight:600;cursor:pointer;transition:background-color .2s}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;font-size:.875rem;color:#6b7280}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-weight:500}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline;color:#1d4ed8}"]})};export{D as LoginComponent};
