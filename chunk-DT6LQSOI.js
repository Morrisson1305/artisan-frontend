import{a as x,b as C,c as I,d as F,e as D,f as T,g as E,k,l as N,m as R,n as A,o as L,p as j,q,r as z,s as G,t as V,u as B}from"./chunk-PZVRPNO4.js";import{a as b}from"./chunk-N35DKANW.js";import"./chunk-TKIRZA44.js";import{f as y}from"./chunk-ZUXIL7TL.js";import{$b as _,Da as l,Ia as m,Oa as u,Sa as g,Xb as h,Za as d,cb as e,db as n,eb as P,jb as c,kb as f,la as M,tb as o,ub as O,vb as w,w as S}from"./chunk-EUQM6YRV.js";function K(a,s){if(a&1&&(e(0,"span"),o(1," Resend OTP in "),e(2,"strong"),o(3),n(),o(4,"s "),n()),a&2){let r=f();l(3),O(r.countdown)}}var v=class a{constructor(s,r,t){this.authService=s;this.dialogRef=r;this.data=t;this.startTimer()}verified=new M;showToast=new M;otpCode="";countdown=300;canResend=!1;timerSub;config={length:4,inputClass:"otp-input",allowNumbersOnly:!0,isPasswordInput:!1,autofocus:!0,placeholder:""};startTimer(){this.countdown=300,this.canResend=!1,this.timerSub?.unsubscribe(),this.timerSub=S(1e3).subscribe(()=>{this.countdown--,this.countdown<=0&&(this.canResend=!0,this.timerSub.unsubscribe())})}onOtpChange(s){this.otpCode=s}handleSubmit(){if(this.otpCode.length!==4){this.showToast.emit("Please enter the 4-digit OTP");return}this.authService.verifyLoginOtp({phone:this.data.phone,otp:this.otpCode}).subscribe({next:()=>{this.verified.emit(),this.dialogRef.close(!0)},error:()=>{this.showToast.emit("Invalid or expired OTP")}})}ngOnDestroy(){this.timerSub?.unsubscribe()}get phone(){return this.data.phone}get type(){return this.data.type}static \u0275fac=function(r){return new(r||a)(m(b),m(q),m(z))};static \u0275cmp=u({type:a,selectors:[["app-four-digit-otp-modal"]],outputs:{verified:"verified",showToast:"showToast"},decls:16,vars:4,consts:[[1,"otp-modal-backdrop"],[1,"otp-modal"],[1,"close-btn",3,"click"],[1,"title"],[1,"subtitle"],[1,"phone"],[3,"onInputChange","config"],[1,"resend-section"],[4,"ngIf"],["type","button",1,"verify-btn",3,"click","disabled"]],template:function(r,t){r&1&&(e(0,"div",0)(1,"div",1)(2,"button",2),c("click",function(){return t.dialogRef.close()}),o(3,"\xD7"),n(),e(4,"h2",3),o(5,"Enter OTP"),n(),e(6,"p",4),o(7," We've sent a 4-digit verification code to "),e(8,"span",5),o(9),n(),o(10,". "),n(),e(11,"ng-otp-input",6),c("onInputChange",function(p){return t.onOtpChange(p)}),n(),e(12,"div",7),g(13,K,5,1,"span",8),n(),e(14,"button",9),c("click",function(){return t.handleSubmit()}),o(15," Verify "),n()()()),r&2&&(l(9),O(t.phone),l(2),d("config",t.config),l(2),d("ngIf",!t.canResend),l(),d("disabled",t.otpCode.length<4))},dependencies:[_,h,R,j,L],encapsulation:2})};function Q(a,s){a&1&&(e(0,"small"),o(1,"Phone number is required."),n())}function X(a,s){a&1&&(e(0,"small"),o(1,"Invalid phone number format."),n())}function Z(a,s){if(a&1&&(e(0,"div",15),g(1,Q,2,0,"small",16)(2,X,2,0,"small",16),n()),a&2){let r,t,i=f();l(),d("ngIf",(r=i.loginForm.get("phone"))==null||r.errors==null?null:r.errors.required),l(),d("ngIf",(t=i.loginForm.get("phone"))==null||t.errors==null?null:t.errors.pattern)}}function tt(a,s){a&1&&(e(0,"div",15)(1,"small"),o(2,"Password is required."),n()())}var U=class a{constructor(s,r,t,i,p){this.fb=s;this.authService=r;this.toast=t;this.router=i;this.dialog=p;this.loginForm=this.fb.group({phone:["",[C.required,C.pattern(/^[0-9]{10,15}$/)]],password:["",[C.required]]})}loginForm;loginPending=!1;showPassword=!1;togglePasswordVisibility(){this.showPassword=!this.showPassword}handleSubmit(){if(this.loginForm.invalid)return;this.loginPending=!0;let{phone:s,password:r}=this.loginForm.value;this.authService.login({phone:s,password:r}).subscribe({next:()=>{let t=this.dialog.open(v,{data:{phone:s,type:"login"},disableClose:!0,width:"700px"});t.componentInstance.verified.subscribe(()=>{let i=this.authService.getUser();this.toast.success("Login successful"),i?.isArtisan?this.router.navigate(["/artisan-dashboard"]):this.router.navigate(["/user-dashboard"])}),t.componentInstance.showToast.subscribe(i=>{this.toast.error(i)})},error:t=>{let i=t.error?.message;i==="User is not verified"?this.toast.warning("Account not verified. Please register again or contact support."):this.toast.error(i||"Invalid phone number or password")},complete:()=>{this.loginPending=!1}})}onToast(s){this.toast.show(s)}static \u0275fac=function(r){return new(r||a)(m(N),m(b),m(B),m(y),m(G))};static \u0275cmp=u({type:a,selectors:[["app-login"]],decls:27,vars:7,consts:[[1,"login-container"],[1,"login-card"],[1,"subtitle"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","phone"],["id","phone","type","tel","formControlName","phone","placeholder","233241234567","required",""],["class","error",4,"ngIf"],["for","password"],[1,"password-wrapper"],["id","password","formControlName","password","placeholder","Enter your password","required","",3,"type"],["type","button",1,"toggle-password",3,"click"],["type","submit",3,"disabled"],[1,"footer-text"],["routerLink","/register"],[1,"error"],[4,"ngIf"]],template:function(r,t){if(r&1&&(e(0,"div",0)(1,"div",1)(2,"h2"),o(3,"Sign in"),n(),e(4,"p",2),o(5,"Enter your credentials to access your account"),n(),e(6,"form",3),c("ngSubmit",function(){return t.handleSubmit()}),e(7,"div",4)(8,"label",5),o(9,"Phone Number"),n(),P(10,"input",6),g(11,Z,3,2,"div",7),n(),e(12,"div",4)(13,"label",8),o(14,"Password"),n(),e(15,"div",9),P(16,"input",10),e(17,"button",11),c("click",function(){return t.showPassword=!t.showPassword}),o(18),n()(),g(19,tt,3,0,"div",7),n(),e(20,"button",12),o(21),n()(),e(22,"div",13)(23,"span"),o(24,"Don't have an account? "),n(),e(25,"a",14),o(26,"Sign up"),n()()()()),r&2){let i,p;l(6),d("formGroup",t.loginForm),l(5),d("ngIf",((i=t.loginForm.get("phone"))==null?null:i.touched)&&((i=t.loginForm.get("phone"))==null?null:i.invalid)),l(5),d("type",t.showPassword?"text":"password"),l(2),w(" ",t.showPassword?"Hide":"Show"," "),l(),d("ngIf",((p=t.loginForm.get("password"))==null?null:p.touched)&&((p=t.loginForm.get("password"))==null?null:p.invalid)),l(),d("disabled",t.loginPending||t.loginForm.invalid),l(),w(" ",t.loginPending?"Signing in...":"Sign in"," ")}},dependencies:[_,h,A,D,x,I,F,k,T,E,V],styles:[".login-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:4rem 1rem;background-color:#f9fafb;min-height:100vh}.login-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background-color:#fff;padding:2rem;border-radius:.5rem;box-shadow:0 2px 8px #0000001a}.login-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;font-size:1.75rem;font-weight:600;margin-bottom:.5rem}.login-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{text-align:center;font-size:.95rem;color:#6b7280;margin-bottom:1.5rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;color:#374151;margin-bottom:.25rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.95rem;outline:none;transition:border-color .2s}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#3b82f6}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]{position:relative}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding-right:4rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .password-wrapper[_ngcontent-%COMP%]   .toggle-password[_ngcontent-%COMP%]{position:absolute;top:50%;right:.75rem;transform:translateY(-50%);background:none;border:none;color:#2563eb;font-size:.85rem;cursor:pointer}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{margin-top:.25rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#dc2626;font-size:.8rem}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;padding:.5rem;border:none;border-radius:.375rem;font-weight:600;cursor:pointer;transition:background-color .2s}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.login-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem;font-size:.875rem;color:#6b7280}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#2563eb;text-decoration:none;font-weight:500}.login-card[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline;color:#1d4ed8}"]})};export{U as LoginComponent};
